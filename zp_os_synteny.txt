# 4 May 2020
# WD: /home/jkimball/haasx092/synteny_figure
# Purpose of this code is to generate a synteny figure showing Zizania palustris and Oryza sativa genomes as linear blocks with links between the two

# Python needs to be loaded
module load python

# First, make bed files from GFF3 files.
# Wild Rice GFF3 file was generated by Marissa as part of the annotation project; Oryza files came from Phytozome (python -m jcvi.apps.fetch phytozome Osativa)
python -m jcvi.formats.gff bed rice.gene_structures_post_PASA_updates.21917.gff3 -o wild_rice.bed
python -m jcvi.formats.gff bed Osativa_323_v7.0.gene.gff3.gz -o oryza.bed

# Next, reformat FASTA files
python -m jcvi.formats.fasta format zizania_palustris_13Nov2018_okGsv.fasta wild_rice.cds
python -m jcvi.formats.fasta format Osativa_323_v7.0.cds.fa.gz oryza.cds

# Find pairwise synteny
python -m jcvi.compara.catalog ortholog wild_rice oryza --no_strip_names

# At this stage, the process is aborted because "A total of 0 anchor was found. Aborted" (exact error message)
# To get around this, I tried using sed to replace "." with "_". This was suggested by others online who encountered the same issue. It did not solve the problem.
# There is probably another issue, but this is still probably necessary.
# sed -i  's/\./_/g' oryza.bed
# sed -i  's/\./_/g' oryza.cds
# The wild rice cds file also has inconsistent naming. This strips the ';HRSCAF=#' portion after the main scaffold number
# sed -i 's/;.*$//g' wild_rice.cds

# The problem was that the jcvi programs depend on LAST (http://last.cbrc.jp). Specifically, lastdb and lastal. I downloaded and installed them, but had problems getting them into the search PATH.
# The thing that I was doing wrong was including the program name in the PATH. When the PATH terminates in the parent directory of the programs, it works like a charm.
# This needs to be run each time a new shell session is started because I haven't permanently added it to my shell profile.
export PATH=$PATH:/home/jkimball/haasx092/synteny_figure/last-1060/src